<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaflet Map Overlay Utility</title>
</head>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js" integrity="sha512-dfX5uYVXzyU8+KHqj8bjo7UkOdg18PaOtpa48djpNbZHwExddghZ+ZmzWT06R5v6NSk3ZUfsH6FNEDepLx9hPQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>

<script src="./TateMapItems2.js"></script>

<style>
    #myfirstmap { height: 800px; width: 100pct}
    .crosshair {cursor: crosshair;}
</style>

<body>
    <button onclick="ToggleTateMap()">Toggle Tate Map</button><br>
    <button onclick="editorMode()">Switch Modes</button>
    <div id="instruction"></div>
    <div class="crosshair", id="myfirstmap"></div>
    <div id="array"></div>
    <div id="theMap" src=""></div>
    <h3>var TateMap = {'features':[</h3>
    <table id="mytable">
        <tr>
            <th>name</th>
            <th>type</th>
            <th>lat</th>
            <th>long</th>
        </tr>
    </table>
    <h3>]}</h3>
    
</body>

<script>
var mymap = L.map('myfirstmap').setView([36.076158444920615,-79.10276412963869], 12);
L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 22,
    attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    }).addTo(mymap);
var roadArray = []
var SWchangelat
var SWchangeLong
var NEchangelat
var NEchangeLong
var maplayer = L.layerGroup().addTo(mymap);
var imageWidth
var imageHeight
var imageScale
var EWScale = 100
var EWscaleSlider = 100
var NSscale = 100
var NSscaleSlider = 100
var cemetery = L.icon({iconUrl: 'cemetery.png', iconSize: [30, 30], popupAnchor: [1, 1]});
var church = L.icon({iconUrl: 'church.png', iconSize: [30, 30], popupAnchor: [1, 1]});
var school = L.icon({iconUrl: 'school.png', iconSize: [30, 30], popupAnchor: [1, 1]});
var mill = L.icon({iconUrl: 'mill.png', iconSize: [30, 30], popupAnchor: [1, 1]});
var building = L.icon({iconUrl: 'building.png', iconSize: [30, 30], popupAnchor: [1, 1]});
var post = L.icon({iconUrl: 'building.png', iconSize: [30, 30], popupAnchor: [1, 1]});
var hill = L.icon({iconUrl: 'hill.png', iconSize: [30, 30], popupAnchor: [1, 1]});
var mining = L.icon({iconUrl: 'mining.png', iconSize: [30, 30], popupAnchor: [1, 1]});
var theTable = document.getElementById('mytable')
var SWcornerLat = 35.80578572403521
var SWcornerLong = -79.30762289701272
var NEcornerLat = 36.30578572403521
var NEcornerLong = -78.89646789701273
var editMode = 1
var imageBounds = [[SWcornerLat,SWcornerLong],[NEcornerLat,NEcornerLong]]
var markerInMotion = -1
var adjustmode = 0
var mode = 0
var erroneousLat
var erroneousLong
var firstCorrectedLocation = []
var imageUrl = './clearedEdges.png'
var markerMode = 0
L.imageOverlay(imageUrl, imageBounds, {opacity: 1}).addTo(maplayer);
var templayer = L.layerGroup().addTo(mymap);
var upordown = 0
var image
var Toggle = 1
mymap.on('mousemove', onMouseMove);
mymap.on('click', clicked);
//mymap.on('contextmenu', rightClickSpotonMap);
Tate();

function clicked(e) {
    var clickLat = e.latlng['lat'] 
    var clickLong = e.latlng['lng']
    TateMap.features[markerInMotion].lat = clickLat
    TateMap.features[markerInMotion].long = clickLong
    mode = 0
    markerInMotion = - 1
    Tate();
}

function moveMarker(a){
    markerInMotion = a
    mode = 1
    maplayer.clearLayers();
    for (var i = 0; i < a; i ++ ){
        var popupText = TateMap.features[i].name + "<button onclick='moveMarker(" + i + ")'>Move this?</button>"
        if (TateMap.features[i].type == "mill"){var marker = L.marker([TateMap.features[i].lat,TateMap.features[i].long], {icon:mill}).addTo(maplayer).bindTooltip(popupText)}
        if (TateMap.features[i].type == "building"){var marker = L.marker([TateMap.features[i].lat,TateMap.features[i].long], {icon:building}).addTo(maplayer).bindTooltip(popupText)}
        if (TateMap.features[i].type == "mining"){var marker = L.marker([TateMap.features[i].lat,TateMap.features[i].long], {icon:mining}).addTo(maplayer).bindTooltip(popupText)}
        if (TateMap.features[i].type == "post"){var marker = L.marker([TateMap.features[i].lat,TateMap.features[i].long], {icon:post}).addTo(maplayer).bindTooltip(popupText)}
        if (TateMap.features[i].type == "cemetery"){var marker = L.marker([TateMap.features[i].lat,TateMap.features[i].long], {icon:cemetery}).addTo(maplayer).bindTooltip(popupText)}
        if (TateMap.features[i].type == "church"){var marker = L.marker([TateMap.features[i].lat,TateMap.features[i].long], {icon:church}).addTo(maplayer).bindTooltip(popupText)}
        if (TateMap.features[i].type == "school"){var marker = L.marker([TateMap.features[i].lat,TateMap.features[i].long], {icon:school}).addTo(maplayer).bindTooltip(popupText)}
        if (TateMap.features[i].type == "hill"){var marker = L.marker([TateMap.features[i].lat,TateMap.features[i].long], {icon:hill}).addTo(maplayer).bindTooltip(popupText)}
    }
    for (var i = a+1; i < TateMap.features.length; i ++ ){
        var popupText = TateMap.features[i].name + "<button onclick='moveMarker(" + i + ")'>Move this?</button>"
        if (TateMap.features[i].type == "mill"){var marker = L.marker([TateMap.features[i].lat,TateMap.features[i].long], {icon:mill}).addTo(maplayer).bindTooltip(popupText)}
        if (TateMap.features[i].type == "building"){var marker = L.marker([TateMap.features[i].lat,TateMap.features[i].long], {icon:building}).addTo(maplayer).bindTooltip(popupText)}
        if (TateMap.features[i].type == "mining"){var marker = L.marker([TateMap.features[i].lat,TateMap.features[i].long], {icon:mining}).addTo(maplayer).bindTooltip(popupText)}
        if (TateMap.features[i].type == "post"){var marker = L.marker([TateMap.features[i].lat,TateMap.features[i].long], {icon:post}).addTo(maplayer).bindTooltip(popupText)}
        if (TateMap.features[i].type == "cemetery"){var marker = L.marker([TateMap.features[i].lat,TateMap.features[i].long], {icon:cemetery}).addTo(maplayer).bindTooltip(popupText)}
        if (TateMap.features[i].type == "church"){var marker = L.marker([TateMap.features[i].lat,TateMap.features[i].long], {icon:church}).addTo(maplayer).bindTooltip(popupText)}
        if (TateMap.features[i].type == "school"){var marker = L.marker([TateMap.features[i].lat,TateMap.features[i].long], {icon:school}).addTo(maplayer).bindTooltip(popupText)}
        if (TateMap.features[i].type == "hill"){var marker = L.marker([TateMap.features[i].lat,TateMap.features[i].long], {icon:hill}).addTo(maplayer).bindTooltip(popupText)}
    }
}

function onMouseMove(e){
    if (mode == 1){
        templayer.clearLayers();
        var mouseLat = e.latlng['lat'] 
        var mouseLong = e.latlng['lng']
        var marker = L.marker([mouseLat,mouseLong]).addTo(templayer)
    }
}

function ToggleTateMap(){
    if (Toggle/2 == Math.floor(Toggle/2)) {
        Toggle = Toggle + 1
        Tate();
    }
    else {
        maplayer.clearLayers();
        L.imageOverlay(imageUrl, imageBounds, {opacity: 1}).addTo(maplayer);
        Toggle = Toggle + 1
    }
}


function Tate(){
    templayer.clearLayers();
    maplayer.clearLayers();
    if (editMode/2 == Math.floor(editMode/2)) {
        for (var i = 0; i < TateMap.features.length; i ++ ){
            var popupText = TateMap.features[i].name + "<br><button onclick='moveMarker(" + i + ")'>Move this?</button>"
            if (TateMap.features[i].type == "mill"){var marker = L.marker([TateMap.features[i].lat,TateMap.features[i].long], {icon:mill}).addTo(maplayer).bindPopup(popupText)}
            if (TateMap.features[i].type == "building"){var marker = L.marker([TateMap.features[i].lat,TateMap.features[i].long], {icon:building}).addTo(maplayer).bindPopup(popupText)}
            if (TateMap.features[i].type == "mining"){var marker = L.marker([TateMap.features[i].lat,TateMap.features[i].long], {icon:mining}).addTo(maplayer).bindPopup(popupText)}
            if (TateMap.features[i].type == "post"){var marker = L.marker([TateMap.features[i].lat,TateMap.features[i].long], {icon:post}).addTo(maplayer).bindPopup(popupText)}
            if (TateMap.features[i].type == "cemetery"){var marker = L.marker([TateMap.features[i].lat,TateMap.features[i].long], {icon:cemetery}).addTo(maplayer).bindPopup(popupText)}
            if (TateMap.features[i].type == "church"){var marker = L.marker([TateMap.features[i].lat,TateMap.features[i].long], {icon:church}).addTo(maplayer).bindPopup(popupText)}
            if (TateMap.features[i].type == "school"){var marker = L.marker([TateMap.features[i].lat,TateMap.features[i].long], {icon:school}).addTo(maplayer).bindPopup(popupText)}
            if (TateMap.features[i].type == "hill"){var marker = L.marker([TateMap.features[i].lat,TateMap.features[i].long], {icon:hill}).addTo(maplayer).bindPopup(popupText)}
        }
    }
    else{
        for (var i = 0; i < TateMap.features.length; i ++ ){
            var popupText = TateMap.features[i].name
            if (TateMap.features[i].type == "mill"){var marker = L.marker([TateMap.features[i].lat,TateMap.features[i].long], {icon:mill}).addTo(maplayer).bindTooltip(popupText)}
            if (TateMap.features[i].type == "building"){var marker = L.marker([TateMap.features[i].lat,TateMap.features[i].long], {icon:building}).addTo(maplayer).bindTooltip(popupText)}
            if (TateMap.features[i].type == "mining"){var marker = L.marker([TateMap.features[i].lat,TateMap.features[i].long], {icon:mining}).addTo(maplayer).bindTooltip(popupText)}
            if (TateMap.features[i].type == "post"){var marker = L.marker([TateMap.features[i].lat,TateMap.features[i].long], {icon:post}).addTo(maplayer).bindTooltip(popupText)}
            if (TateMap.features[i].type == "cemetery"){var marker = L.marker([TateMap.features[i].lat,TateMap.features[i].long], {icon:cemetery}).addTo(maplayer).bindTooltip(popupText)}
            if (TateMap.features[i].type == "church"){var marker = L.marker([TateMap.features[i].lat,TateMap.features[i].long], {icon:church}).addTo(maplayer).bindTooltip(popupText)}
            if (TateMap.features[i].type == "school"){var marker = L.marker([TateMap.features[i].lat,TateMap.features[i].long], {icon:school}).addTo(maplayer).bindTooltip(popupText)}
            if (TateMap.features[i].type == "hill"){var marker = L.marker([TateMap.features[i].lat,TateMap.features[i].long], {icon:hill}).addTo(maplayer).bindTooltip(popupText)}
        }
    }
    fillTable();
}

function fillTable(){
    theTable.innerHTML=""
    for (var i = 0; i < TateMap.features.length; i++){
        var myNewRow = document.createElement('tr');
        var name = document.createElement('td');
        var type = document.createElement('td');
        var lat = document.createElement('td');
        var long = document.createElement('td');
        name.innerText = "{'name':'" + TateMap.features[i].name + "','type':'" + TateMap.features[i].type + "','lat':" + TateMap.features[i].lat + ",'long':" + TateMap.features[i].long + "},"
        myNewRow.append(name)
        theTable.append(myNewRow);
    }
}

function editorMode(){
    editMode = editMode + 1
    Tate();
}

</script>
</html>