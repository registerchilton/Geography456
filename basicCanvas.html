
<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8" />
    <title>Canvas Digital Elevation Model Handler</title>
  </head>
    <style>
    .crosshair {cursor: crosshair;}
    </style>
  <body>
    <h3 id="instructions">Click the Button below to load the Digital Elevation Model.</h3>
    <br>
    <button onclick="dimensions()">Load the image</button><br>
    <button onclick="whiten()">Bleach the image</button><br>
    <div id="pixelValues"></div>
    <canvas class="crosshair" id="canvas" width="1600" height="1600"></canvas>
    <br>
    <img id="theMap" src="https://registerchilton.github.io/Geography456/RockyRiverWatershed.jpg" alt="Digital Elevation Model">
  </body>

<script type="application/javascript">
    var img = document.getElementById("theMap")
    var imageWidth
    var imageHeight
    var lowestNeighbor = 9
    console.log(img)
    function draw() {
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");
        ctx.drawImage(img, 0, 0);
        document.getElementById("instructions").innerText = "Click on the Digital Elevation Model to search for down hill paths."
    }

    function dimensions() {
        imageWidth = document.getElementById("theMap").naturalWidth;
        imageHeight = document.getElementById("theMap").naturalHeight;
        document.getElementById("canvas").width = imageWidth
        document.getElementById("canvas").height = imageHeight
        const canvas = document.getElementById("canvas");
        if (canvas.getContext) {
            const ctx = canvas.getContext("2d");
            img.onload = () => {ctx.drawImage(img, 0, 0);}
        }
        draw();
    }

    function getPixel(x,y){
        console.log("testing " + x + "," + y)
	    const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d", {willReadFrequently: true});
        myImageData = ctx.getImageData(x, y, 1, 1);
	    console.log("lookin for neighbors below " + myImageData.data)
        var comment = "RGB values are: red " + myImageData.data[0] + ", green " + myImageData.data[1] + ", blue " + myImageData.data[2] 
        document.getElementById("pixelValues").innerText = comment
    }

    function getMousePosition(canvas, event) {
        let rect = canvas.getBoundingClientRect();
        let x = event.clientX - rect.left;
        let y = event.clientY - rect.top;
        x = Math.floor(x);
        y = Math.floor(y);
        console.log("Coordinates " + x + "," + y);
        const ctx = canvas.getContext("2d");
        ctx.beginPath();
        ctx.moveTo(x, y);
        getPixel(x,y);
    }

	let canvasElem = document.getElementById("canvas");
        canvasElem.addEventListener("mousedown", function (e) {
		getMousePosition(canvasElem, e);
	});

    function whiten(){
        const ctx = canvas.getContext("2d");
        for (var i = 0; i < imageWidth; i++){
            for (var j = 0; j < imageHeight; j++){
                myImageData = ctx.getImageData(i, j, 1, 1);
                if (myImageData.data[0] > 0) {
                    console.log("whitening")
                    myImageData.data[0] = 255
                }
                if (myImageData.data[1] > 200) {
                    console.log("whitening")
                    myImageData.data[1] = 255
                }
                if (myImageData.data[2] > 200) {
                    console.log("whitening")
                    myImageData.data[2] = 255
                }
            }
        }
    }
</script>
</html>