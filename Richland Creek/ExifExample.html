<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>EXIF example with inline EXIF info</title>
</head>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>
<style>
    #myfirstmap { height: 500px; width: 500px}
</style>

<body>
    <div id="myfirstmap"></div>
    <button onclick="imageChange()">Next photo</button>
    <img src="IMG_20240311_150045.jpg" id="img1" style="width:500px"/>
    <pre>Latitude and Longitude: <span id="LatLong"></span></div>
    <br/>

    <script type="text/javascript" src="./exif.js"></script>
    <script>
    "use strict";
    window.onload=getExif;
    var mymap = L.map('myfirstmap').setView([0,0], 5);
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {maxZoom: 19,
    attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(mymap);

    var lat
    var long
    var image = 1
        function getExif() {
            console.log("Exif function firing")
            var img1 = document.getElementById("img1");
            EXIF.getData(img1, function() {
                lat = EXIF.getTag(this, "GPSLatitude");
                var longref = EXIF.getTag(this, "GPSLongitudeRef");
                var latref = EXIF.getTag(this, "GPSLatitudeRef");
                console.log("LongRef is " + longref)
                long = EXIF.getTag(this, "GPSLongitude");
                var latitude = lat[0] + (lat[1]/60) + (lat[2]/3600)
                var longitude= long[0] + (long[1]/60) + (long[2]/3600)
                if (longref == "W") {longitude = longitude * -1}
                if (latref == "S") {latitude = latitude * -1}
                var coords = document.getElementById("LatLong");
                coords.innerHTML = `${latitude} ${longitude}`;
                var coordinates = []
                coordinates.push(latitude)
                coordinates.push(longitude)
                mymap.flyTo(coordinates, 14)
                var picture = "<img src='IMG_20240311_150045.jpg' style='width:50px'/>"
                var marker = L.marker(coordinates).addTo(mymap)
                .bindPopup(picture).openPopup();
            });
        }
        function imageChange(){
            image = image + 1
            if (image == 4) {image = 1}
            if (image == 1) {document.getElementById('img1').src = "IMG_20240311_150045.jpg"}
            if (image == 2) {document.getElementById('img1').src = "IMG_20240311_150525.jpg"}
            if (image == 3) {document.getElementById('img1').src = "IMG_20240311_150754.jpg"}
            getExif();

        }
    </script>
</body>
</html>
